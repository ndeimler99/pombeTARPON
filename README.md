# pombeTARPON

pombeTARPON is a telomere analysis and research pipeline designed for the analysis of Schizosaccharomyces pombe telomeres that originate from whole genome sequencing datasets. This pipeline may also be suitable for the analysis of data using an enrichment methodology; however, that is untested. If this pipeline is used within your research, please cite this GitHub page. This pipeline is still under development and should be used with caution. If interested in more details,the users should contact Nathaniel Deimler at nathanieldeimler.research@gmail.com to learn more.

The NextFlow Pipeline consists of 3 subworkflows. The first validates all input parameters, the second converts files into the appropriate type, and the third analyses the sequencing data to calculate telomere length and chromosome arm specific telomere statistics. This pipeline should only be used for the analysis of S. pombe sequencing data. For organisms with invariant telomeric repeats please see github.com/ndeimler99/TARPON. While this pipeline can be used with other heterogenous telomeric repeats, it must be extensively tested. If working with S. cerevisiae data, cereTARPON should be used.

Prior to the execution of the pipeline, pod5 files should be basecalled using dorado SUP basecalling with the --no-trim parameter specified. After basecalling, dorado can be used to demultiplex reads prior to the execution of pombeTARPON. Currently, this pipeline needs to be run with the following parameters --input and --demuxed.

## Validate Parameters Subworkflow

This subworkflow first ensures that data does not exist within the specified --outdir based on the presence of an html report. The input directory --input must exist. As the pipeline continues to evolve and more options are added such as demultiplexing and capture probe sequences are used for enrichment, further parameters will be added here to ensure pipeline use.

## Pre-process Files Subworkflow

Files are loaded from the specified --input directory and verified to ensure they are in the UBAM format. One file per sample should be found within this directory. Do not perform alignment prior to the execution of pombeTARPON. If files are not in the UBAM format, they must be in the FASTQ file, and will be converted to UBAM during this subworkflow using picard. Telomeres are then isolated from the sequencing data. The first and last 1,000 bp (--read_fragment_length) are searched for at least 3 telomeric repeats in the correct orientation (at the beginning of the read C strand and the end of the read G strand). The total number of G strand repeats is compared to the total number of G and C strand repeats identified. If this fraction is less than 0.30 (--minimum_strand_percentage), the strand is determined to be a C strand telomeric sequence. If it is greater than 0.7 (1-0.3), it is G strand, and if it falls between 0.3 and 0.7 the read is identified as chimeric and removed from the analysis. C strand telomeres are then reverse complemented into the G orientation for further downstream simplicity; however, the original strand identity is tracked within the bam file and exported in the final stats file.

## Telomere Analysis Subworkflow

Putative telomeric sequences are then assessed to identify the telomere start, telomere end, and calculate telomere length. Assuming the telomeric repeat (--repeat) is not changed from its default value of GGTTAC, python based regex is used to identify telomeric repeats 'GGTTAC((AC)|A){0,1}G{0,7}?' with a required base of GGTTAC, followed (optionally) by AC or A, followed by between 0-7 G's.  The end of the telomere is identified through the last two (--telo_end_repeat_count) telomeric repeats present in the read allowing for two errors (--telo_end_repeat_errors). If the end of a telomere is identified, the sequence continues through filtering to identify the start of the telomere. The start of the telomere is either identified by the first four (--telop_start_repeat_count) telomeric repeats with 4 alled errors (--telo_start_repeat_errors) or a canonical telomere start sequence (GGGTTACAAGGTTACG, --canonical start) with an allowed 3 errors (--canonical_start_errors). The start is first identified using consecutive telomeric repeats and if a canonical start sequence is found and it occurs before the identified start site the telomere start position is redefined. After identifying the telomere start and end, the percentage of the resulting telomeric sequence that is composed of telomeric repeats (see previously described regex) is calculated and if the telomere is composed of greater than 80% telomeric repeats, is included for further downstream analysis. The 80% threshold accounts for sequencing error within nanopore sequencing.


Telomeric sequences are then clustered using MeshClust to identify chromosome arm specific telomere length. MeshClust is executed requiring a 95% identity (--cluster_similarity_threshold) between sequences and attempts to cluster the 5000 (--cluster_telo_length) bases immediately subtelomere proximal to the telomere start site previously identified. Additionally, sequences that are identified to contain a complete telomere, are then blasted against TAS and rDNA sequences (--rDNA_TAS_file) provided in pombeTARPON. Clustering results are then plotted with the TAS/rDNA sequences identified via blast annotated to verify the accuracy of the clustering approach. Depending on the strain used and chromosome arm similarity, different thresholds may need to be used. Additional motifs for visualization canbe added by including the sequence in the --rDNA_TAS_file and updating the data/color_dict.txt file appropriately. After clustering, if the --consensus parameter is specified, a consensus sequence per chromsome arm will be generated based on an across sequence similarity of 70%.

## Output

A variety of files is generated as output including png images of clustering results and pdf files of telomere lengths. All telomeric reads included in the final analys is outputted as a bam file with a corresponding .txt file that lists all descriptive statistics for thes reads and can easily be used to generate custom plots. Additionally, in the future a default HTML report will also be included in the output.





This pipeline utilizes ezcharts to aid in the generation of bokeh plots for the final HTML report. Please see the following disclaimer as well as the License provided in the LICENSE folder for use of this software. This product includes software developed by Oxford Nanopore Technologies Plc.
